\chapter{生物地球化学循环预热加速}\label{生物地球化学循环预热加速}
%\addcontentsline{toc}{chapter}{生物地球化学循环预热加速}
\begin{mymdframed}{代码}
  本节对应的代码文件为\texttt{MOD\_BGC\_CNSASU.F90}。
\end{mymdframed}

%\begin{生物地球化学循环预热加速}
生物地球化学循环预热是陆地生态系统碳氮循环模拟必不可少的初始化过程，是众多模式比较计划都采用的标准初始化流程。
生物地球化学循环预热通过重复使用同样的气候强迫场和大气二氧化碳浓度数据，使陆地生态系统碳氮储量达到平衡。
通常来说，不同模型间平衡态碳氮储量的差异往往大于历史时期由于$\rm CO_2$浓度上升引起的碳氮储量变化的不确定性。
因此，生物地球化学循环预热过程十分重要。但由于高纬度地区的低温气候造成土壤分解过慢，
碳氮预热达到平衡态需要上千年的模拟时间，如何加速生物地球化学循环预热过程十分关键。
CoLM生物地球化学循环模块运用半解析预热方法~\citep{xia2012semi}。从碳氮平衡方程入手，求解平衡态的碳氮库大小。


\section{植被生物地球化学循环预热加速}
CoLM植被碳氮循环可以表示为21个碳库和22个氮库的碳氮平衡方程组~\citep{lu2020full}，
可以写成矩阵形式：
\begin{equation}
  \frac{{\mathrm {d}} C_{\mathrm{veg}}}{{\mathrm {d}} t}=B I_{\mathrm{Cin}}+\left(A_{\mathrm{p h c}}(t) K_{\mathrm{p h c}}+A_{\mathrm{gmc}}(t) K_{\mathrm{gmc}}\right) C_{\mathrm{veg}}(t)
\end{equation}
\begin{equation}
  \frac{{\mathrm {d}} N_{\text {veg}}}{{\mathrm {d}} t}=B I_{\mathrm{Nin}}+\left(A_{\mathrm{phn}}(t) K_{\mathrm{phn}}+A_{\mathrm{gmn}}(t) K_{\mathrm{gmn}}\right) N_{\text {veg }}(t)
\end{equation}
$C_{\mathrm{veg}}$ 和$N_{\mathrm{veg}}$ 是植被碳氮库的状态变量 (\unit{g.C.m^{-2}} 和 \unit{g.N.m^{-2}})，是长度分别为21和22的列向量，
具体内容见章节~\ref{植被碳氮库结构} 对植被碳氮库的详细介绍。$I_{\mathrm{Cin}}$ 和$I_{\mathrm{Nin}}$ 分别是植被的碳氮输入(\unit{g.C.m^{-2}.s^{-1}} 和 \unit{g.N.m^{-2}.s^{-1}})，
是标量。其中，碳输入来源于净第一性生产力，氮输入来源于生物固氮和植被被动氮吸收。
$B$是分配系数向量，代表植被碳氮输入分配到每个植被碳氮库的比例。
$K_{\mathrm{phc}}$和$K_{\mathrm{gmc}}$是21$\times$21的对角矩阵，分别代表植被每个库因为物候过程和自然死亡过程产生的碳周转速率(\unit{s^{-1}})。
$K_{\mathrm{phn}}$和$K_{\mathrm{gmn}}$是22$\times$22的对角矩阵，分别代表植被每个库因为物候过程和自然死亡过程产生的氮周转速率(\unit{s^{-1}}):
\begin{equation}
  K_{\mathrm{p h c}}=\left(\begin{array}{ccc}k_{\mathrm{p 1}} & \cdots & 0 \\ \vdots & \ddots & \vdots \\ 0 & \cdots & k_{\mathrm{p 21}}\end{array}\right)
\end{equation}
\begin{equation}
  K_{\mathrm{gmc}}=\left(\begin{array}{ccc}k_{\mathrm{g 1}} & \cdots & 0 \\ \vdots & \ddots & \vdots \\ 0 & \cdots & k_{\mathrm{n 21}}\end{array}\right)
\end{equation}
\begin{equation}
  K_{\mathrm{phn}}=\left(\begin{array}{ccc}k_{\mathrm{p 1}} & \cdots & 0 \\ \vdots & \ddots & \vdots \\ 0 & \cdots & k_{\mathrm{p 22}}\end{array}\right)
\end{equation}
\begin{equation}
  K_{\mathrm{gmn}}=\left(\begin{array}{ccc}k_{\mathrm{g 1}} & \cdots & 0 \\ \vdots & \ddots & \vdots \\ 0 & \cdots & k_{\mathrm{n 22}}\end{array}\right)
\end{equation}
$A_{\mathrm{phc}}$和$A_{\mathrm{phn}}$分别是碳氮传输系数矩阵，代表不同植被碳氮库之间的传输比例。

\afterpage{%\clearpage %
  \begin{landscape}
    \enlargethispage{10pt}
    \begin{equation}
      A_{\mathrm{phc}}=\left(\begin{array}{rcccccccccccccccccc}
          -1 & 0 & a_{1,3} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
          0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
          0 & a_{3,2} & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
          0 & 0 & 0 & -1 & 0 & a_{4,6} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
          0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
          0 & 0 & 0 & 0 & a_{6,5} & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
          0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & a_{7,9} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
          0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
          0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{9,8} & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
          0 & 0 & 0 & 0 & 0 & 0 & a_{10,7} & 0 & 0 & -1 & 0 & a_{10,12} & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
          0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &0 \\
          0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{12,11}&-1 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
          0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & a_{13,15} & 0 & 0 & 0 & 0\\
          0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 \\
          0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{15,14}&-1 & 0 & 0 & 0 & 0\\
          0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{16,13} & 0 & 0 & -1 & 0 & a_{16,18} \\
          0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0&-1 & 0\\
      0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &  a_{18,17} & -1\end{array}\right)
    \end{equation}
  \end{landscape}
}

%\afterpage{%\clearpage %
\begin{landscape}
  \enlargethispage{55pt}
  \begin{equation}
    A_{\mathrm{phn}}=\left(\begin{array}{rcccccccccccccccccc}
        -1 & 0 & a_{1,3} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{1,19} \\
        0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{2,19} \\
        0 & a_{3,2} & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{3,19} \\
        0 & 0 & 0 & -1 & 0 & a_{4,6} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{4,19} \\
        0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{5,19} \\
        0 & 0 & 0 & 0 & a_{6,5} & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{6,19} \\
        0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & a_{7,9} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{7,19} \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{8,19} \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{9,8} & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{9,19} \\
        0 & 0 & 0 & 0 & 0 & 0 & a_{10,7} & 0 & 0 & -1 & 0 & a_{10,12} & 0 & 0 & 0 & 0 & 0 & 0 & a_{10,19} \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{11,19} \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{12,11}&-1 & 0 & 0 & 0 & 0 & 0 & 0 & a_{12,19} \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & a_{13,15} & 0 & 0 & 0 & a_{13,19} \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & a_{14,19} \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{15,14}&-1 & 0 & 0 & 0 & a_{15,19} \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{16,13} & 0 & 0 & -1 & 0 & a_{16,18}& a_{16,19} \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & a_{17,19} \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & a_{18,17}&-1 & a_{18,19} \\
        a_{19,1} & 0 & 0 & a_{19,4} & 0 & 0 & a_{19,7} & 0 & 0 & a_{19,10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1
    \end{array}\right)
  \end{equation}
\end{landscape}
%}
\begin{landscape}
  \enlargethispage{55pt}
  \begin{equation}
    A_{\mathrm{gmc}}=\left(\begin{array}{rrrrrrrrrrrrrrrrrrrrrrrrrrrrrr}
        -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0  & -1
    \end{array}\right)
  \end{equation}
\end{landscape}

\begin{landscape}
  \enlargethispage{55pt}
  \begin{equation}
    A_{\mathrm{gmn}}=\left(\begin{array}{rrrrrrrrrrrrrrrrrrrrrrrrrrrrrr}
        -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 &0 \\
    0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1\end{array}\right)
  \end{equation}
\end{landscape}
其中，矩阵的非对角元素 $a_{(i,j)}$, 代表从$j$到$i$的碳氮传输在$j$库总周转掉的碳氮中的比例。


当碳氮平衡方程中$({\mathrm {d}} C_{\mathrm{veg}})/{\mathrm {d}} t=0$和 $({\mathrm {d}} N_{\mathrm{veg}})/{\mathrm {d}} t=0$，则碳氮处于平衡状态，所以可以解得植被碳氮的平衡状态($C_{\mathrm{(veg,ss)}}$, $N_{\mathrm{(veg,ss)}}$)是：
\begin{equation}
  C_{\mathrm{veg, s s}}=\left(A_{\mathrm{p h c}}(t) K_{\mathrm{p h c}}+A_{\mathrm{gmc}}(t) K_{\mathrm{gmc}}\right)^{-1} B I_{\mathrm{{Cin }}}
\end{equation}
\begin{equation}
  N_{\mathrm{veg, s s}}=\left(A_{\mathrm{phn}}(t) K_{\mathrm{phn}}+A_{\mathrm{gmn}}(t) K_{\mathrm{gmn}}\right)^{-1} B I_{\mathrm{Nin}}
\end{equation}
由于生物地球化学循环运用循环的气象强迫场数据，所以平衡状态需要累加计算一个气象循环的平均值。


\section{土壤凋落物生物地球化学循环预热加速}
CoLM土壤凋落物的碳氮循环可以表示为7个碳库和7个氮库的碳氮平衡方程组~\citep{lu2020full}，其中每个库在土壤垂直方向分为10层，可以写成矩阵形式：
\begin{equation}
  \frac{{\mathrm {d}} C_{\text {soil }}}{{\mathrm {d}} t}=I_{\mathrm{C \text { soil }}}+\left[A_{\mathrm{h c}} \xi(t) K_{\mathrm{h}}+V(t)\right] C_{\text {soil }}(t)
\end{equation}
\begin{equation}
  \frac{{\mathrm {d}} N_{\text {soil }}}{{\mathrm {d}} t}=I_{\mathrm{N s o i l}}+\left[A_{\mathrm{h n}} \xi(t) K_{\mathrm{h}}+V(t)\right] N_{\text {soil }}(t)
\end{equation}
$C_{\mathrm{soil}}$和$N_{\mathrm{soil}}$是CoLM土壤凋落物有机碳氮库的状态变量(\unit{g.C.m^{-3}} 和 \unit{g.N.m^{-3}}), 是向量。
$I_{\mathrm{Csoil}}$和$I_{\mathrm{Nsoil}}$同样是长度为70的向量，代表进入土壤碳氮库中不同分层的凋落物输入。
$A_{\mathrm{hc}}$ 和$A_{\mathrm{hn}}$代表土壤碳氮在同一层内不同库之间的传输系数。$V$土壤碳氮在不同层之间的传输系数：
\begin{equation}
  A_{\mathrm{h c}} \text { or } A_{\mathrm{h n}}=\left(\begin{array}{ccccccc}
      A_{11} & 0 & 0 & 0 & 0 & 0 & 0 \\
      0 & A_{22} & 0 & 0 & 0 & 0 & 0 \\
      A_{31} & 0 & A_{33} & 0 & 0 & 0 & 0 \\
      A_{41} & 0 & 0 & A_{44} & 0 & 0 & 0 \\
      0 & A_{52} & A_{53} & 0 & A_{55} & A_{56} & A_{57} \\
      0 & 0 & 0 & A_{64} & A_{65} & A_{66} & 0 \\
  0 & 0 & 0 & 0 & A_{75} & A_{76} & A_{77}\end{array}\right)
\end{equation}
其中每个子矩阵 $A_{ij}$ 都是10$\times$10的对角矩阵:

\begin{equation}
  A_{i j}=\left\{\begin{array}{ccc}{\left[\begin{array}{ccc}-1 & \cdots & 0 \\ \vdots & \ddots & \vdots \\ 0 & \cdots & -1\end{array}\right]}   &i=j;\ C\ and\ N\ cycles \\
      {\left[\begin{array}{ccc}\left(1-r f_{j}\right) T_{i j} & \cdots & \\ \vdots & \ddots & \vdots \\ 0 & \cdots & \left(1-r f_{j}\right) T_{i j}\end{array}\right]}   &\ i\neq j;\ C\ cycle\ \left(A_{hc}\right)\  \\
  {\left[\begin{array}{cccc}\left(1-r f_{j}\right) T_{i j} \frac{C N_{j}(1)}{C N_{i}(1)} & \cdots & 0 \\ \vdots & \ddots & \vdots \\ 0 & & \cdots & \left(1-r f_{j}\right) T_{i j} \frac{C N_{j}(10)}{C N_{i}(10)}\end{array}\right]}& i\neq j;\ N\ cycle\left(A_{\mathrm{hn}}\right) \end{array}\right.
\end{equation}


对角线上的子矩阵 $A_{ii}$是负的单位矩阵。非对角子矩阵$A_{ij}$代表10层土壤中的传输系数的差异。
$r_{ij}$, $T_{ij}$，$CN_{j(z)}$以及环境控制因子$\xi$在第~\ref{土壤凋落物生物地球化学循环过程} 章都有过详细介绍。

周转速率矩阵$K_{\mathrm {h}} $是对角矩阵，代表土壤分解过程在不同土壤分层引起的碳氮周转：
\begin{equation}
  K_{\mathrm{h}}=\left(\begin{array}{ccc}k_{1} & \cdots & 0 \\ \vdots & \ddots & \vdots \\ 0 & \cdots & k_{\mathrm{n}}\end{array}\right)
\end{equation}
垂直传输系数矩阵V是由6个同样的三对角矩阵组成$v$:
\begin{equation}
  V(t)=\left(\begin{array}{ccccccc}v & 0 & 0 & 0 & 0 & 0 & 0 \\ 0 & v & 0 & 0 & 0 & 0 & 0 \\ 0 & 0 & v & 0 & 0 & 0 & 0 \\ 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ 0 & 0 & 0 & 0 & v & 0 & 0 \\ 0 & 0 & 0 & 0 & 0 & v & 0 \\ 0 & 0 & 0 & 0 & 0 & 0 & v\end{array}\right)
\end{equation}
其中CoLM的粗木质残体库不存在土壤的垂直传输，所以其对应的矩阵$v$是0。
其余库对应的矩阵都是三对角矩阵，意味着碳氮的垂直传输只发生在相邻的两层土壤之间:
\begin{equation}
  \begin{array}{c}v=\operatorname{diag}\left({\mathrm {d}} z_{1},{\mathrm { d}} z_{2}, \ldots,{\mathrm {  d}} z_{20}\right)^{-1} \\
    \left(\begin{array}{ccccccc}g_{1} & -g_{1} & 0 & & 0 & 0 & 0 \\
        -h_{2} & h_{2}+g_{2} & -g_{2} & \ldots & 0 & 0 & 0 \\ 0 & -h_{3} & h_{3}+g_{3} & & 0 & 0 & 0 \\
        & \vdots & & \ddots & & \vdots & \\ 0 & 0 & 0 & & h_{18}+g_{18} & -g_{18} & 0 \\
  0 & 0 & 0 & \ldots & -h_{19} & h_{19}+g_{19} & -g_{19} \\ 0 & 0 & 0 & & 0 & -h_{10} & h_{20}\end{array}\right)\end{array}
\end{equation}
其中${\mathrm {d}} z$代表每层土壤的厚度，$g$和$h$是土壤碳氮的上行和下行垂直传输系数。

当碳氮平衡方程中$({\mathrm {d}} C_{\mathrm{soil}})/{\mathrm {d}} t=0$和 $({\mathrm {d}} N_{\mathrm{soil}})/{\mathrm {d}} t=0$，则碳氮处于平衡状态，
所以可以解得植被碳氮的平衡状态($C_{\mathrm{(soil,ss)}}$, $N_{\mathrm{(soil,ss)}}$)是：
%
\begin{equation}
  C_{\mathrm{soil, s s}}=\left[A_{\mathrm{h c}} \xi(t) K_{\mathrm{h}}+V(t)\right]^{-1} I_{\mathrm{C s o i l}}
\end{equation}
\begin{equation}
  N_{\mathrm{soil, s s}}=\left[A_{\mathrm{h n}} \xi(t) K_{\mathrm{h}}+V(t)\right]^{-1} I_{\mathrm{N s o i l}}
\end{equation}
同样的，由于生物地球化学循环运用循环的气象强迫场数据，
所以土壤碳氮的平衡状态也需要累加计算一个气象循环的平均值。 
